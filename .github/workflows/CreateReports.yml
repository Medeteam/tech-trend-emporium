name: Comment Commit changes

on:
  workflow_run:
    workflows: [CICDPipeline]
    types:
      - completed
    branches: 
      - Features/*

permissions:
  contents: write

jobs:
  reports:
    name: Comment Commit
    runs-on: ubuntu-latest
    steps:
      - name: commenting the action
        uses: actions/github-script@v6
        with:
          script: |
            const status = process.env.GITHUB_WORKFLOW_CONCLUSION;
            const sha = github.event.workflow_run.head_commit.id;  // Correct reference to the head commit ID
            const ref = github.event.workflow_run.head_commit.tree_id;  // Reference to the branch or tree
            const repo = github.repository.split('/')[1];
            const owner = github.repository.split('/')[0];
            const comment = `Pipeline Status: ${status}\nCommit: ${sha}\nBranch: ${ref}\nRepository: ${owner}/${repo}`;

            await github.rest.repos.createCommitComment({
              owner: owner,
              repo: repo,
              commit_sha: sha,
              body: comment
            });
